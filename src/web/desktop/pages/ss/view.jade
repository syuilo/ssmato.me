extend ../../main

block title
	if login
		= ss.title
	else
		= ss.title + ' - SSまとめ'

block meta
	meta(name='keywords', content='SS, SSまとめ')
	meta(name='description', content= summary)
	meta(property='og:title', content= ss.title + ' - SSまとめ')
	meta(property='og:type', content='article')
	meta(property='og:description', content= summary)
	meta(property='og:url', content= config.url + '/' + ss.id)
	meta(property='og:image', content= config.urls.resources + '/logo.jpg')
	meta(property='og:site_name', content='SSまとめ')
	meta(property='twitter:card', content='summary')
	meta(property='twitter:site', content='@syuilo')
	meta(property='twitter:title', content= ss.title + ' - SSまとめ')
	meta(property='twitter:description', content= summary)
	meta(property='twitter:image', content= config.urls.resources + '/logo.jpg')
	meta(property='twitter:url', content= config.url + '/' + ss.id)

block assets
	script(src='https://apis.google.com/js/platform.js', async, defer).
		{lang: 'ja'}

block content
	article
		div.ss(data-id= ss.id, data-is-favorited='false')
			header
				div.title
					h1= ss.title
					span.count= ss.posts.length
					button.favorite(data-tooltip='お気に入りに登録')
						i.fa.fa-heart
				
				div.info
					div.top
						span.pages
							= ss.pagesCount
							| ページ
						span.separator ・
						span.time
							| 読むのに必要な時間: およそ
							= ss.readingTimeMinutes
							| 分
						div.status
							p.views
								i.fa.fa-eye
								span.count= ss.views.length
							p.comments
								i.fa.fa-comments
								span.count= ss.commentsCount
							p.favorites
								i.fa.fa-heart
								span.count= ss.favoritesCount
					div.bottom
						div.series
							p.caption
								i.fa.fa-folder-open
							if ss.series.length == 0
								span.unknown 不明
							else if ss.series.length == 1
								a.title(href= config.urls.series + '/' + ss.series[0].id, title=ss.series[0].kana)= ss.series[0].title
							else
								each series in ss.series
									a.title(href= config.urls.series + '/' + series.id, title=series.kana)= series.title
								span.is-cross
									| (クロス)
						
						if ss.characters.length > 0
							div.characters
								p.caption
									i.fa.fa-users
								ul
									each chara in ss.characters
										li: a(href= config.urls.character + '/' + chara.profile.id,
											title= chara.profile.name + ' (' + chara.profile.kana + ')',
											style='color:' + chara.profile.color)= chara.profile.screenName
					if ss.characters.length > 0
						div.on-stage-ratio
							each chara in ss.characters
								a(href= config.urls.character + '/' + chara.profile.id,
									data-tooltip= chara.profile.name + ' ' + (Math.round((chara.onStageRatio * 100) * 10) / 10) + '%',
									style={
										background: chara.profile.color,
										opacity: chara.onStageRatio / ss.characters[0].onStageRatio,
										width: (Math.round((chara.onStageRatio * 100) * 10) / 10) + '%'
									})
			
				button.read-later(data-tooltip='あとで読む'): i.fa.fa-clock-o
				
			div.body
				p.filter
					span.caption
						i.fa.fa-filter
						| フィルター:
					if filterMode == 'auto'
						span.mode.active 自動
					else
						a.mode(href= config.urls.api + '/set-filter?mode=auto&callback=' + url) 自動
					if filterMode == 'master'
						span.mode.active 本文だけ
					else
						a.mode(href= config.urls.api + '/set-filter?mode=master&callback=' + url) 本文だけ
					if filterMode == 'none'
						span.mode.active なし
					else
						a.mode(href= config.urls.api + '/set-filter?mode=none&callback=' + url) なし

				div.share
					span.twitter.
						<a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
						<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
					span.google-plus.
						<div class="g-plus" data-action="share" data-annotation="bubble"></div>
					span.line.
						<span>
						<script type="text/javascript" src="//media.line.me/js/line-button.js?v=20140411" ></script>
						<script type="text/javascript">
						new media_line_me.LineButton({"pc":true,"lang":"ja","type":"a"});
						</script>
						</span>

				div.posts
					each post in posts
						- var popularity = null;
						- if (!post.isMaster) {
						-   if (post.popularity > 25) popularity = 'c';
						-   if (post.popularity > 50) popularity = 'b';
						-   if (post.popularity > 75) popularity = 'a';
						- }
						article.post(id= post.number, data-id= post.id, data-popularity= popularity)
							header
								a.number(href= '#' + post.number)= post.number
								h2.name= post.userName
								time.created-at(datetime= post.createdAt.toISOString())= post.displayCreatedAt
								span.id(style='background:' + post.userIdBackgroundColor + ';color:' + post.userIdForegroundColor)= post.userId
							div.body
								div.text!= post.html
								div.actions
									button.like(title='高評価')
										i.fa.fa-thumbs-o-up
									button.dislike(title='低評価')
										i.fa.fa-thumbs-o-down

			footer
				small.source
					if ss.url.indexOf('http://ex14.vip2ch.com/') == 0
						| SS速報VIPに投稿されたスレッドの紹介です
						a(href= ss.url, target='_blank')
							| 【SS速報VIP】
							= ss.title
							|  
							= ss.url
					else
						| 元スレッド
						a(href= ss.url, target='_blank')= ss.url
